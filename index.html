// ====== Torus ======
const torusGeometry = new THREE.TorusGeometry(1.5, 0.5, 64, 128);
const torusMaterial = new THREE.MeshStandardMaterial({
  color: new THREE.Color(0x4B0082),
  emissive: new THREE.Color(0x220044),
  metalness: 0.4,
  roughness: 0.3
});
const torus = new THREE.Mesh(torusGeometry, torusMaterial);
scene.add(torus);

// ====== Luxvar Words & Audio Files ======
const luxvarColumns = [
  { word: "ŠAURÉN", color: 0x6a0dad, audio: "audio/shauren.mp3" },
  { word: "ṆĀRAH–ŠĀ", color: 0x0057b8, audio: "audio/narahsha.mp3" },
  { word: "ZARTH", color: 0x4682b4, audio: "audio/zarth.mp3" },
  { word: "VUUM", color: 0x1e90ff, audio: "audio/vuum.mp3" },
  { word: "ELŪZ", color: 0x00ced1, audio: "audio/eluz.mp3" },
  { word: "MAHAR", color: 0x20b2aa, audio: "audio/mahar.mp3" },
  { word: "SĀR", color: 0x32cd32, audio: "audio/sar.mp3" },
  { word: "RAHTALĒN", color: 0xff8c00, audio: "audio/rahtalen.mp3" },
  { word: "ŠALŌM", color: 0xff4500, audio: "audio/shalom.mp3" },
  { word: "ḤATTAH", color: 0xff1493, audio: "audio/hattah.mp3" },
  { word: "ANĀLŪZ", color: 0xdb7093, audio: "audio/analuz.mp3" },
  { word: "VARZIN", color: 0xffffff, audio: "audio/varzin.mp3" }
];

// ====== Audio Player ======
let currentAudio = null;
function playColumnAudio(filePath) {
  if (currentAudio) {
    currentAudio.pause();
    currentAudio.currentTime = 0;
  }
  currentAudio = new Audio(filePath);
  currentAudio.volume = 1.0;
  currentAudio.play();
}

// ====== Process Question ======
function processQuestion() {
  const q = document.getElementById("askInput").value.trim();
  document.getElementById("askModal").style.display = 'none';
  if (!q) return;

  // Column selection by wave key
  let sum = 0;
  for (let i = 0; i < q.length; i++) sum += q.charCodeAt(i);
  const phi = 1.618;
  const key = Math.floor((sum / phi) % 12);

  const chosen = luxvarColumns[key];
  torus.material.color.set(chosen.color);

  // Show response text
  const msg = document.getElementById("message");
  msg.innerHTML = <b>${chosen.word}</b><br><i>Resonance Activated</i>;
  msg.style.opacity = 1;
  setTimeout(() => { msg.style.opacity = 0; }, 6000);

  // Play the real recorded voice
  playColumnAudio(chosen.audio);
}

document.getElementById("askBtn").addEventListener("click", () => {
  document.getElementById("askModal").style.display = 'flex';
});

let clock = new THREE.Clock();
function animate() {
  requestAnimationFrame(animate);
  torus.rotation.x += 0.005 * (3/5);
  torus.rotation.y += 0.005;
  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
