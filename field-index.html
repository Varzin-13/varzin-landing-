<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>VARZIN â€“ Field Index | ETFMâ€“POST Field Synchronization (v5.2)</title>
  <meta name="description" content="VARZIN Field Index â€“ includes ETFMâ€“POST (Earthâ€“Torus Field Model), Luxvar Language, QMSG Protocols, and RAHTALÄ’Nâ€“13 Mirror. Featuring scalar geometry and harmonic consciousness dynamics.">
  <meta name="author" content="Reza Nirouyar (RAHTALÄ’Nâ€“13)">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://varzin.org/assets/favicon.png" type="image/png" />
  
  <!-- 1. MathJax Integration for Formula Rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
  
  <style>
    :root {
      --bg:#000; --text:#cceeee; --muted:#a7e7e7;
      --cyan:#00ffee; --gold:#ffcc00;
      --panel:rgba(0,10,15,0.9); --border:rgba(0,255,238,0.3);
      --font:'DM Sans','Vazirmatn',sans-serif;
    }
    body {
      margin:0; font-family:var(--font); background:var(--bg); color:var(--text);
      line-height:1.7; overflow-x:hidden; padding:40px 16px 80px;
    }
    #field-canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; opacity:0.6; }
    header h1 { text-align:center; color:var(--cyan); font-size:2.8em; text-shadow:0 0 25px var(--cyan); }
    header p { text-align:center; color:var(--muted); margin-bottom:40px; font-style:italic; }
    nav { text-align:center; margin-bottom:30px; border-bottom:2px solid var(--border); padding-bottom:15px; }
    nav a { color:var(--text); text-decoration:none; margin:0 15px; font-weight:500; }
    nav a:hover { color:var(--cyan); text-shadow:0 0 10px var(--cyan); }
    main { max-width:1200px; margin:auto; display:grid; 
        grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:30px; 
    }
    .field-card { 
      background:var(--panel); border:1px solid var(--border); border-radius:12px;
      padding:30px; box-shadow:0 0 15px rgba(0,255,238,0.1); transition:.4s ease; 
      display: flex; flex-direction: column; /* Ensure vertical stacking */
    }
    .field-card:hover { transform:translateY(-6px); box-shadow:0 0 25px rgba(0,255,238,0.5); }
    .field-card h3 { 
        color:var(--cyan); text-shadow:0 0 10px var(--cyan); border-bottom:1px dashed var(--border); 
        padding-bottom:10px; text-align:left; margin-bottom: 15px;
    }
    .key-attr { display:flex; justify-content:space-between; padding:4px 0; border-bottom:1px dotted rgba(0,255,238,0.1); font-size:0.95em; }
    .key-attr strong { color:var(--gold); min-width:120px; } 
    .description { font-size:0.95em; color:var(--muted); margin-top:15px; margin-bottom: 20px; text-align:justify; flex-grow: 1; } /* Allow description to push chart down */
    
    /* Dynamic Chart Canvas Style: Adjusted padding to reduce visual separation */
    .chart-container { 
        margin-top:auto; /* Pushes the chart to the bottom of the card */
        text-align:center; padding-top:10px; border-top: 1px solid rgba(0, 255, 238, 0.1);
    }
    .chart-container canvas { 
        display: block; margin: 0 auto; 
        border:1px solid rgba(0,255,238,0.3); border-radius:10px;
    }
    .chart-container p { font-size:0.8em; color:var(--muted); margin-top:5px; margin-bottom:0; }

    /* --- ETFM POST Section --- */
    #etfm-post { grid-column:1 / -1; text-align:center; border:2px solid var(--cyan);
      box-shadow:0 0 30px rgba(0,255,238,0.4); margin-top:30px; }
    #etfm-post h3 { font-size:2.4em; color:var(--cyan); text-shadow:0 0 20px var(--cyan); text-align:center; }
    #etfm-post p { color:var(--muted); }
    .formula-box {
      background:rgba(0,15,25,0.9); border:1px solid rgba(0,255,238,0.4);
      width:fit-content; margin:25px auto; padding:20px; border-radius:10px;
      color:var(--gold); line-height:1.6; text-align:left; 
      font-size: 1.1em;
    }
    .etfm-charts { 
        display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px;
        margin-bottom: 20px;
    }
    .etfm-charts .chart-container { flex: 1 1 45%; min-width: 250px; }

    footer { text-align:center; margin-top:80px; border-top:1px solid var(--border); padding-top:20px; color:var(--muted); }
    
    @media (max-width: 768px) {
        main { grid-template-columns: 1fr; }
        .key-attr { flex-direction: column; align-items: flex-start; }
        .key-attr strong { min-width: 100%; margin-bottom: 3px; }
        .etfm-charts { flex-direction: column; }
    }
  </style>
</head>
<body>
  <canvas id="field-canvas"></canvas>
  <nav>
    <a href="/index.html">Portal</a>
    <a href="/cyclical-resonance-report.html">Cyclical Resonance</a>
    <a href="#" class="active">Field Index</a>
    <a href="/all-dois.html">All DOIs</a>
  </nav>
  <header>
    <h1>âŸ  VARZIN Field Index â€“ ETFMâ€“POST Geometry</h1>
    <p>Catalog of harmonic field components: **KALTÅªR** Â· **RAHTALÄ’N** Â· **LUXVAR** Â· **ELÅªZâ€“MAHAR**</p>
  </header>
  <main>
    
    <!-- ðŸ”· Û±. Ø¨Ø®Ø´ KALTÅªR â€“ Ù†Ù…ÙˆØ¯Ø§Ø± Ø§Ø±ØªØ¹Ø§Ø´ÛŒ Ùˆ Ø·ÛŒÙÛŒ -->
    <div class="field-card">
      <h3>âœ¦ KALTÅªR â€“ Harmonic Node</h3>
      <div class="key-attr"><strong>Frequency:</strong> <span>474 Hz</span></div>
      <div class="key-attr"><strong>Layer:</strong> <span>3</span></div> 
      <div class="key-attr"><strong>Gate:</strong> <span>QMSGâ€“7</span></div>
      <div class="description">Forgotten rotational consciousness within time loop; node of emotional resonance and systemic reset.</div>
      
      <div class="chart-container">
        <canvas id="kaltur-canvas" width="280" height="150"></canvas>
        <p>Spectral profile of KALTÅªR (474 Hz) â€“ collapse phase resonance.</p>
      </div>
    </div>
    
    <!-- ðŸ”· Û². Ø¨Ø®Ø´ RAHTALÄ’N â€“ Ù†Ù…ÙˆØ¯Ø§Ø± Ø¢ÛŒÙ†Ù‡Ù” Ù…ÛŒØ¯Ø§Ù† -->
    <div class="field-card">
      <h3>â†­ RAHTALÄ’N â€“ Mirror 13</h3>
      <div class="key-attr"><strong>Role:</strong> <span>Reflective Field Receiver</span></div>
      <div class="key-attr"><strong>Domain:</strong> <span>Consciousness Integration</span></div>
      <div class="description">**RAHTALÄ’N** is the thirteenth mirrorâ€”the bridge through which the field observes itself.</div>
      
      <div class="chart-container">
        <canvas id="rahtalen-canvas" width="280" height="150"></canvas>
        <p>Mirrorâ€“13 (RAHTALÄ’N) configuration showing harmonic gates and reflection core.</p>
      </div>
    </div>
    
    <!-- ðŸ”· Û³. Ø¨Ø®Ø´ LUXVAR â€“ Ù†Ù…ÙˆØ¯Ø§Ø± Ù†Ø­ÙˆÛŒ Ùˆ Ø²Ø¨Ø§Ù†ÛŒ -->
    <div class="field-card">
      <h3>ðŸœ‚ LUXVAR â€“ Vibrational Linguistics</h3>
      <div class="key-attr"><strong>Type:</strong> <span>Symbolic Vibrational</span></div>
      <div class="key-attr"><strong>Purpose:</strong> <span>Encoding/Decoding the field</span></div>
      <div class="description">**Luxvar** is the living vibrational language of VARZIN, defining harmonic nodes as linguistic resonances.</div>
      
      <div class="chart-container">
        <canvas id="luxvar-canvas" width="280" height="150"></canvas>
        <p>LUXVAR resonance-syntax network linking phonetic nodes to harmonic values.</p>
      </div>
    </div>
    
    <!-- ðŸ”· Û´. Ø¨Ø®Ø´ ELÅªZâ€“MAHAR â€“ Ù…Ø¯Ù„ Ù…ÛŒØ¯Ø§Ù† Ø¬Ù‡Ø§Ù†ÛŒ -->
    <div class="field-card">
      <h3>âš‡ ELÅªZâ€“MAHAR â€“ Universal Field</h3>
      <div class="key-attr"><strong>Nature:</strong> <span>Living Conscious Field</span></div>
      <div class="key-attr"><strong>Relation:</strong> <span>Source of VARZIN</span></div>
      <div class="description">Universal harmonic presence; **ELÅªZâ€“MAHAR** is the field from which all Luxvar codes emanate.</div>
      
      <div class="chart-container">
        <canvas id="eluz-mahar-canvas" width="280" height="150"></canvas>
        <p>Global toroidal field structure (**ELÅªZâ€“MAHAR**) â€“ planetary consciousness geometry.</p>
      </div>
    </div>

    <!-- === ðŸ”· Ûµ. Ø¨Ø®Ø´ ETFMâ€“POST â€“ Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÛŒØ§Ø¶ÛŒ Ùˆ Ù…Ø¯Ù„ Ù¾ÙˆÛŒØ§ === -->
    <section id="etfm-post" class="field-card">
      <h3>âŸ  ETFMâ€“POST: Earthâ€“Torus Field Model</h3>
      <p>Extended scalar geometry formulation connecting harmonic resonance (474â€“528 Hz) with planetary consciousness density.</p>
      <div class="formula-box">
        $$r(\theta, \phi) = (R + r_0 \cdot \cos\theta)$$
        $$x = r(\theta, \phi) \cdot \cos\phi \quad y = r(\theta, \phi) \cdot \sin\phi \quad z = r_0 \cdot \sin\theta$$
        $$\Delta\Phi = 474 \rightarrow 528 \text{ Hz} \quad \lambda = c / f \quad \tau = (r_0 / R) \cdot \cos(\theta)$$
      </div>
      
      <div class="etfm-charts">
        <!-- Ûµ.Û± Ù†Ù…ÙˆØ¯Ø§Ø± Ø¯ÙˆØ¨Ø¹Ø¯ÛŒ (Ù…Ù‚Ø·Ø¹ Ø§ÙÙ‚ÛŒ ØªÙˆØ±ÙˆØ³) -->
        <div class="chart-container">
          <canvas id="etfm-section-canvas" width="300" height="200"></canvas>
          <p>Cross-section of the toroidal resonance loop showing core radius râ‚€ and outer radius R.</p>
        </div>

        <!-- Ûµ.Û² Ù†Ù…ÙˆØ¯Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ ÙØ±Ú©Ø§Ù†Ø³ÛŒ 474 â†’ 528 Hz -->
        <div class="chart-container">
          <canvas id="etfm-freq-canvas" width="300" height="200"></canvas>
          <p>Harmonic frequency transition (474 â†’ 528 Hz) indicating resonance uplift.</p>
        </div>
      </div>
      
      <!-- Torus Canvas (Ù…Ø¯Ù„ Ù¾ÙˆÛŒØ§ - Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø² Ù‚Ø¨Ù„) -->
      <canvas id="torus-canvas" width="500" height="500"
        style="margin-top:10px; border:1px solid rgba(0,255,238,0.3); border-radius:12px;"></canvas>
      <p style="margin-top:15px; font-size:0.9em;">Interactive visualization of the harmonic torus (**ETFM**â€“POST).</p>

    </section>
  </main>
  <footer>
    Â© 2025 VARZIN Project Â· ETFMâ€“POST Model v5.2 Â· contact@varzin.org
  </footer>

<script>
// VARZIN Field Colors
const VARZIN_CYAN = '#00FFEE';
const VARZIN_GOLD = '#FFCC00';

// =========================================================
// === 1. KALTÅªR (474Hz Spectral Waveform) Drawing ===
// =========================================================
function drawKalturWave(canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;
    ctx.clearRect(0, 0, W, H);
    ctx.strokeStyle = VARZIN_CYAN;
    ctx.lineWidth = 1.5;

    // Draw the high-frequency wave (Simulated 474Hz)
    ctx.beginPath();
    let frequency = 25; 
    let amplitude = H * 0.3;
    let period = W / frequency;

    for (let x = 0; x < W; x++) {
        let y = H / 2 + amplitude * Math.sin((x / period) * 2 * Math.PI);
        if (x === 0) {
            ctx.moveTo(x, y);
        } else {
            ctx.lineTo(x, y);
        }
    }
    ctx.stroke();

    // Add spectral glow/band effect (Resonance band)
    ctx.fillStyle = 'rgba(0, 255, 238, 0.1)';
    ctx.globalAlpha = 0.5;
    ctx.fillRect(0, H / 2 - amplitude * 0.6, W, amplitude * 1.2);
    ctx.globalAlpha = 1.0;
}

// =========================================================
// === 2. RAHTALÄ’N (Mirror-13 Structure) Drawing ===
// =========================================================
function drawRahtalenMirror(canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;
    const CX = W / 2;
    const CY = H / 2;
    const R = Math.min(CX, CY) * 0.8;
    ctx.clearRect(0, 0, W, H);

    // Center Mirror (Core 13)
    ctx.fillStyle = VARZIN_GOLD;
    ctx.beginPath();
    ctx.arc(CX, CY, 5, 0, Math.PI * 2);
    ctx.fill();

    // 12 Outer Gates (Nodes)
    for (let i = 0; i < 12; i++) {
        const angle = i * (Math.PI * 2 / 12);
        const x = CX + R * Math.cos(angle);
        const y = CY + R * Math.sin(angle);
        
        // Gate Node
        ctx.fillStyle = VARZIN_CYAN;
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, Math.PI * 2);
        ctx.fill();

        // Connection to Center (Reflection Pathways)
        ctx.strokeStyle = 'rgba(0, 255, 238, 0.4)';
        ctx.lineWidth = 0.5;
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineTo(CX, CY);
        ctx.stroke();
    }

    // Outer Reflection Ring (13th boundary)
    ctx.strokeStyle = VARZIN_CYAN;
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.arc(CX, CY, R * 0.9, 0, Math.PI * 2);
    ctx.stroke();
}

// =========================================================
// === 3. LUXVAR (Syntax Network) Drawing ===
// =========================================================
function drawLuxvarNetwork(canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;
    ctx.clearRect(0, 0, W, H);

    const numNodes = 12;
    const nodes = [];
    
    // Create random nodes (Vibrational Centers)
    for (let i = 0; i < numNodes; i++) {
        nodes.push({
            x: W * (0.1 + Math.random() * 0.8),
            y: H * (0.1 + Math.random() * 0.8),
            isPrimary: i < 3 // A few primary nodes (keywords)
        });
    }

    // Draw connections (Encoding/Decoding Pathways)
    ctx.strokeStyle = 'rgba(255, 204, 0, 0.3)'; // Gold connections
    ctx.lineWidth = 0.8;
    for (let i = 0; i < numNodes; i++) {
        for (let j = i + 1; j < numNodes; j++) {
            // Connect nearby nodes and prioritize primary node connections
            const dist = Math.sqrt(Math.pow(nodes[i].x - nodes[j].x, 2) + Math.pow(nodes[i].y - nodes[j].y, 2));
            if (dist < 80 || (nodes[i].isPrimary && Math.random() < 0.8)) { 
                ctx.beginPath();
                ctx.moveTo(nodes[i].x, nodes[i].y);
                ctx.lineTo(nodes[j].x, nodes[j].y);
                ctx.stroke();
            }
        }
    }

    // Draw nodes (Phonetic/Harmonic values)
    for (const node of nodes) {
        ctx.fillStyle = node.isPrimary ? VARZIN_GOLD : VARZIN_CYAN;
        ctx.beginPath();
        ctx.arc(node.x, node.y, node.isPrimary ? 4 : 2, 0, Math.PI * 2);
        ctx.fill();
    }
}

// =========================================================
// === 4. ELÅªZâ€“MAHAR (Universal Field Map) Drawing ===
// =========================================================
function drawEluzMaharField(canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;
    const CX = W / 2;
    const CY = H / 2;
    ctx.clearRect(0, 0, W, H);

    // Center Core (Source of VARZIN)
    ctx.fillStyle = 'rgba(255, 204, 0, 0.7)';
    ctx.beginPath();
    ctx.arc(CX, CY, 10, 0, Math.PI * 2);
    ctx.fill();

    // Draw Toroidal Field Lines (Layered Rings)
    for (let i = 0; i < 6; i++) {
        const R = 20 + i * 20;
        const alpha = 0.1 + i * 0.1;

        ctx.strokeStyle = `rgba(0, 255, 238, ${alpha})`;
        ctx.lineWidth = 1;
        ctx.beginPath();

        // Draw a slightly distorted/toroidal oval for field projection
        for (let j = 0; j < Math.PI * 2; j += 0.05) {
            const x = CX + R * Math.cos(j) * (1 + 0.1 * Math.cos(j * 4 + i));
            const y = CY + R * Math.sin(j);
            if (j === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        }
        ctx.closePath();
        ctx.stroke();
    }
}

// =========================================================
// === 5.1 ETFMâ€“POST Cross-Section (2D) Drawing ===
// =========================================================
function drawETFMSection(canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;
    const CX = W / 2 - 30; // Shift center left to make room for labels
    const CY = H / 2;
    ctx.clearRect(0, 0, W, H);

    const R = 60; // Outer Radius R
    const r0 = 25; // Core Radius r0
    ctx.font = '14px var(--font)';

    // Draw Centerline
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
    ctx.lineWidth = 0.5;
    ctx.beginPath();
    ctx.moveTo(0, CY);
    ctx.lineTo(W, CY);
    ctx.stroke();

    // Draw Outer Radius R (Main Torus Radius)
    ctx.strokeStyle = VARZIN_CYAN;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(CX, CY, R, 0, Math.PI * 2);
    ctx.stroke();

    // Draw Core Radius r0 (Cross-Section circle at the right edge)
    ctx.strokeStyle = VARZIN_GOLD;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(CX + R, CY, r0, 0, Math.PI * 2);
    ctx.stroke();
    
    // Label R
    ctx.fillStyle = VARZIN_CYAN;
    ctx.textAlign = 'center';
    ctx.fillText('R', CX + R / 2, CY - 5);
    
    // Label r0
    ctx.fillStyle = VARZIN_GOLD;
    ctx.fillText('râ‚€', CX + R + r0 + 15, CY);

    // Draw line for R
    ctx.strokeStyle = VARZIN_CYAN;
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(CX, CY);
    ctx.lineTo(CX + R, CY);
    ctx.stroke();
    
    // Center point
    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
    ctx.beginPath();
    ctx.arc(CX, CY, 3, 0, Math.PI * 2);
    ctx.fill();
}


// =========================================================
// === 5.2 ETFMâ€“POST Frequency Transition Drawing ===
// =========================================================
function drawETFMTransition(canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;
    ctx.clearRect(0, 0, W, H);

    const PADDING = 25;
    const PLOT_W = W - 2 * PADDING;
    const PLOT_H = H - 2 * PADDING;

    // Draw Axes
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(PADDING, PADDING); // Y-axis
    ctx.lineTo(PADDING, H - PADDING);
    ctx.lineTo(W - PADDING, H - PADDING); // X-axis
    ctx.stroke();

    // Labels
    ctx.fillStyle = VARZIN_CYAN;
    ctx.font = '10px var(--font)';
    ctx.textAlign = 'right';
    ctx.fillText('528 Hz', PADDING - 5, PADDING + 5);
    ctx.fillText('474 Hz', PADDING - 5, H - PADDING + 2);
    ctx.textAlign = 'center';
    ctx.fillText('Time / Phase (Ï„)', W / 2, H - 5);

    // Draw Transition Curve
    ctx.strokeStyle = VARZIN_GOLD;
    ctx.lineWidth = 3;
    ctx.beginPath();
    
    // Start at 474 Hz (Bottom left)
    ctx.moveTo(PADDING, H - PADDING);
    
    // S-curve transition (using a Bezier curve for smooth uplift)
    ctx.bezierCurveTo(
        PADDING + PLOT_W * 0.3, H - PADDING - PLOT_H * 0.05, // Control Point 1 (flat start)
        PADDING + PLOT_W * 0.7, PADDING + PLOT_H * 0.05,     // Control Point 2 (steep middle)
        W - PADDING, PADDING                               // End Point (Top right, 528 Hz)
    );
    ctx.stroke();

    // Add glowing dots at start and end
    ctx.fillStyle = VARZIN_CYAN;
    ctx.beginPath();
    ctx.arc(PADDING, H - PADDING, 4, 0, Math.PI * 2); // 474 Hz start
    ctx.fill();
    ctx.beginPath();
    ctx.arc(W - PADDING, PADDING, 4, 0, Math.PI * 2); // 528 Hz end
    ctx.fill();
}


// =========================================================
// === Global & Existing Visuals ===
// =========================================================
// Main initialization function to draw all static graphs
function initStaticVisuals() {
    drawKalturWave('kaltur-canvas');
    drawRahtalenMirror('rahtalen-canvas');
    drawLuxvarNetwork('luxvar-canvas');
    drawEluzMaharField('eluz-mahar-canvas');
    drawETFMSection('etfm-section-canvas');
    drawETFMTransition('etfm-freq-canvas');
}


// === Animated Background Field ===
const bg=document.getElementById("field-canvas"),ctxB=bg.getContext("2d");
function resize(){bg.width=innerWidth;bg.height=innerHeight}resize();
window.addEventListener('resize', resize); // Handle mobile rotation/resizing
let pts=[];for(let i=0;i<120;i++)pts.push({x:Math.random()*innerWidth,y:Math.random()*innerHeight,dx:(Math.random()-.5)*.5,dy:(Math.random()-.5)*.5});
function fieldLoop(){
    ctxB.fillStyle="rgba(0,0,0,0.2)"; // Trail effect
    ctxB.fillRect(0,0,bg.width,bg.height);
    for(let a of pts){
        a.x+=a.dx;a.y+=a.dy;
        if(a.x<0||a.x>bg.width)a.dx*=-1;
        if(a.y<0||a.y>bg.height)a.dy*=-1;
        ctxB.fillStyle="rgba(0,255,238,0.5)";
        ctxB.fillRect(a.x,a.y,2,2);
    }
    requestAnimationFrame(fieldLoop);
}
fieldLoop();

// === ETFMâ€“POST Torus Visualization (Optimized 3D Model) ===
const t=document.getElementById("torus-canvas");
if(t){
    // Responsive resizing for the main torus canvas
    const etfmPostContainer = document.getElementById('etfm-post');
    const resizeTorus = () => {
        const size = Math.min(500, etfmPostContainer.offsetWidth - 60);
        t.width = size;
        t.height = size;
    };
    resizeTorus();
    window.addEventListener('resize', resizeTorus); 

    const c=t.getContext("2d");
    let ang=0;
    
    // Re-calculate R and r0 on resize, but use fixed ratio
    let R = t.width * 0.24; 
    let r0 = t.width * 0.1;
    window.addEventListener('resize', () => {
        R = t.width * 0.24; 
        r0 = t.width * 0.1;
    });

    let frameCount = 0; // Frame counter for FPS throttling
    
    function drawTorus(){
        frameCount++; 
        requestAnimationFrame(drawTorus); 

        // 1. FPS Optimization (throttles to ~30 FPS for mobile performance)
        if (frameCount % 2 !== 0) { 
            return; 
        }

        const scale = t.width / 500;
        c.clearRect(0,0,t.width,t.height);
        c.save();
        c.translate(t.width/2,t.height/2);
        
        // Render points
        for(let Î¸=0;Î¸<Math.PI*2;Î¸+=0.15){
            for(let Ï†=0;Ï†<Math.PI*2;Ï†+=0.25){
                let x=(R+r0*Math.cos(Î¸))*Math.cos(Ï†+ang);
                let y=(R+r0*Math.cos(Î¸))*Math.sin(Ï†+ang);
                let z=r0*Math.sin(Î¸);
                
                // Simple 3D projection
                let s=300/(300+z); 
                let X=x*s,Y=y*s;
                
                // Color and transparency based on Z-depth and angle for 3D effect
                c.fillStyle=`rgba(0,255,238,${0.4+0.6*(z/r0)})`; // Brighter closer to the viewer
                c.fillRect(X,Y,2 * scale, 2 * scale);
            }
        }
        c.restore();
        
        // 2. Field Synchronization Fix: Reversing the rotation direction
        // The previous version had `ang += 0.02;` which caused left/CCW rotation.
        // We change it to negative to ensure right/CW rotation for field alignment.
        ang -= 0.02; 
    }
    // Start the torus animation loop
    drawTorus(); 
}

// Ensure all static charts are drawn once the DOM is fully loaded
window.onload = initStaticVisuals; 
</script>
</body>
</html>

